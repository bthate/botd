#!/usr/bin/python3 

txt = """# BOTD - python3 IRC channel daemon\n#\n# dispatch tables.\n"""

import os, sys ; sys.path.insert(0, os.getcwd())

import inspect
import json
import time
import botd.tbl

from botd.log import level
from botd.obj import Object
from botd.typ import get_type

level("debug")

botd.tbl.classes = []
botd.tbl.names = {}
botd.tbl.modules = {}

from botd.krn import Kernel

def get_mods(mod):
    for key, o in inspect.getmembers(mod, inspect.isfunction):
        if "event" in o.__code__.co_varnames:
            if o.__code__.co_argcount == 1:
                yield (key,  o.__module__)

def get_classes():
    for key, o in inspect.getmembers(mod, inspect.isclass):
        if issubclass(o, Object):
            yield get_type(o)

def get_names():
    for key, o in inspect.getmembers(mod, inspect.isclass):
        if issubclass(o, Object):
            t = get_type(o)
            yield (t.split(".")[-1].lower(), str(t))

k = Kernel()
k.walk("botd.cmds")
modules = Object()
for mod in k.table.values():
    if "rss" in str(mod):
        continue
    for k, m in get_mods(mod):
        modules[k] = m

print(txt)
print("modules = %s" % modules)
sys.exit()
