#!/usr/bin/python3 -u
# BOTLIB - the bot library !
#
#

import bot.obj, os

from bot.krn import k
from bot.shl import daemon, drop, execute, parse_cli, root, setwd
from bot.irc import IRC

from botd.rss import Fetcher

def main():
    cfg = parse_cli()
    if not root():
        bot.obj.workdir = os.path.expanduser("~/.bot")
        daemon()        
    else:
        bot.obj.workdir = "/var/lib/botd"
        drop()
    k.walk("botd")
    i = IRC()
    i.start()
    f = Fetcher()
    f.start()
    k.start()
    k.wait()
       
execute(main)
