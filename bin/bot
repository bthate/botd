#!/usr/bin/python3 -u
# BOTLIB - Framework to program bots.
#
# bin/bot (irc bot)

import os,sys ; sys.path.insert(0, os.getcwd())

import bot
import lo
import logging
import os
import time

from bot.krn import Kernel
from lo.csl import Console
from lo.shl import daemon, execute, parse_cli

opts = [
    ('-x', '--exec', 'store_true', False, 'execute a command', 'exec'),
    ('-m', '--modules', 'store', str, "bot.shw", 'modules to load.', 'modules'),
    ('-w', '--workdir', 'store', str, os.path.join(os.path.expanduser("~/.bot")), 'set working directory.', 'workdir'),
    ('-l', '--loglevel', 'store', str, "error", 'set loglevel.', 'level'),
    ('-a', '--logfile', 'store', str, os.path.join(os.path.expanduser("~/.bot"), "logs", "bot.log"), 'file to log to.', 'logfile'),
]

def main():
    cfg = parse_cli("bot", opts, bot.__version__, """\n\n1) bot -x <cmds>\n2) bot -m <mods> -l <level> -w <dir> -a <file>\n3) e.g. bot -m shw,rss,irc -l debug -w data -a bot.log\n\ndefault directory is ~/.bot""")
    logging.warning("BOT %s started at %s" % (bot.__version__, time.ctime(time.time())))
    k = Kernel()
    if cfg.exec:
        k.cmd(cfg.txt)
        return
    mods = k.walk(cfg.modules)
    k.scan(mods)
    k.init(mods)
    k.start(True)
    k.wait()
    
execute(main)
os._exit(0)
