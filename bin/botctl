#!/usr/bin/python3
# BOTD - python3 IRC channel daemon.
#
# control the bot daemon.

__version__ = 1

import os, sys; sys.path.insert(0, os.getcwd())

from bl.csl import Console
from bl.krn import Kernel
from bl.log import level
from bl.shl import execute, parse_cli
from bl.utl import hd

opts = [
    ('-d', '--datadir', 'store', str, 'set working directory.', 'workdir'),
    ('-m', '--modules', "store", str, "modules to load.", 'modules'),
    ('-n', '--name', "store", str, "program name", 'name'),
    ('-o', '--options', "store", str, "options to use.", 'options'),
    ('-l', '--loglevel', 'store', str, 'set loglevel.', 'level'),
    ('-s', '--save', 'store_true', False, 'save kernel config.', 'dosave')
]

def main():
    cfg = parse_cli(opts)
    k = Kernel()
    k.load_mod("botd.cmd")
    k.start(cfg)
    k.cmd(k.cfg.txt)
 
try:     
    execute(main)
except PermissionError:
    print("you need to run botctl as root")
    
os._exit(0)
